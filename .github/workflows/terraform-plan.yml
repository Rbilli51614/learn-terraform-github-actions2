name: "Terraform Plan"
id: plan
if: github.event_name == 'pull_request'
run: terraform plan -no-color -input=false
continue-on-error: true
name: Update Pull Request
uses: actions/github-script@v6
if: github.event_name == 'pull_request'
env:
  PLAN: ${{ steps.plan.outputs.stdout }}
with:
  github-token: ${{ secrets.GITHUB_TOKEN }}
  script: |
    const output = `#### Terraform Format and Style ğŸ–Œ\`${{ steps.fmt.outcome }}\`
    #### Terraform Initialization âš™ï¸\`${{ steps.init.outcome }}\`
    #### Terraform Validation ğŸ¤–\`${{ steps.validate.outcome }}\`
    #### Terraform Plan ğŸ“–\`${{ steps.plan.outcome }}\`

    <details><summary>Show Plan</summary>

    \`\`\`terraform\n
    ${process.env.PLAN}
    \`\`\`

    </details>

    *Pushed by: @${{ github.actor }}, Action: \`${{ github.event_name }}\`*`;

    github.rest.issues.createComment({
      issue_number: context.issue.number,
      owner: context.repo.owner,
      repo: context.repo.repo,
      body: output
    })
name: Terraform Plan Status
if: steps.planrun: exit 1